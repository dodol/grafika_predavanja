
\documentclass[9pt]{beamer}
\input{../../config/config.tex}
%\documentclass[ucs]{beamer}
%\usetheme[menuwidth={0.3\paperwidth}]{erlangen}
%\setbeamercovered{transparent=20} 

\usepackage{amsmath,amsfonts,amsthm,amssymb}
\usepackage{setspace}
\usepackage{Tabbing}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{extramarks}
\usepackage{chngpage}
\usepackage{soul,color}
\usepackage{graphicx,float,wrapfig}
\usepackage{xcolor}
\usepackage[normalem]{ulem}
\usepackage{mathtools}
\usepackage{cancel}

\definecolor{erlangenlyellow}{RGB}{123, 25, 121}
%\usepackage[utf8x]{inputenc}
%\usepackage{default}
%\usepackage[T1]{fontenc}

\usepackage{verbatim}
\usepackage{listings}
\usepackage{algorithm2e}


\usepackage{subcaption}
\usepackage{lmodern}

\title{Ray tracing}

\subtitle{Podnaslov}
\institute{Računalna grafika}

% Delete this, if you do not want the table of contents to pop up at
% the beginning of each subsection:
%\AtBeginSubsection[]
%{
%  \begin{frame}<beamer>{Outline}
%    \tableofcontents[currentsection,currentsubsection]
%  \end{frame}
%}
%
%\AtBeginSection[]
%{
%  \begin{frame}<beamer>{Outline}
%    \tableofcontents[currentsection]
%  \end{frame}
%}

\begin{document}
\begin{frame}
 \titlepage
\end{frame}

\begin{frame}{Sadržaj}
  \tableofcontents
  % You might wish to add the option [pausesections]
\end{frame}

%
%\begin{frame}{Render jednadžba}
%	\begin{align*}
%	L_o(X, \hat{\omega}_o) = L_e(X, \hat{\omega}_e) +
%	 \int_{S^2}  L_i(X, \hat{\omega}_i) f_X(\hat{\omega}_i), \hat{\omega}_o)) \left|\hat{\omega}_i\cdot \hat{n}\right| 
%	 \mathrm{d} \hat{\omega}_i
%	\end{align*}
%	\begin{itemize}
%		\item $X$: točka u sceni
%		\item $\hat{\omega}_o$: izlazni smjer(\textit{outgoing dir}), smjer prema očištu
%		\item $\hat{\omega}_i$: dolazni, ulazni smjer(\textit{incoming dir}), smjer svjetla na točku $X$ 
%    	\item $\hat{n}$: normala površine
%		\item $S^2$: svi dolazni, ulazni smjerovi(\textit{incoming directions})
%	\end{itemize}
%\end{frame}
%
%\begin{frame}{Render jednadžba}
%	\begin{align*}
%	L_o(X, \hat{\omega}_o) = L_e(X, \hat{\omega}_e) +
%	\int_{S^2}  L_i(X, \hat{\omega}_i) f_X(\hat{\omega}_i), \hat{\omega}_o)) \left|\hat{\omega}_i\cdot \hat{n}\right| 
%	\mathrm{d} \hat{\omega}_i
%	\end{align*}
%	\begin{itemize}
%		\item $L_o(X, \hat{\omega}_o)$: Izlazno svjetlo - Kakav je rezultirajući intenzitet svjetla za zadanu točku i smjer?
%		\item $L_e(X, \hat{\omega}_e)$: Emitirano svjetlo - Kakav je intenzitet svjetla koji emitira zadana točka za zadani smjer? - Recimo izvor svjetla
%		\item $L_i(X, \hat{\omega}_i)$: Dolazno, ulazno svjetlo - za zadanu točku koji intenzitet svjetla vidim za zadani smjer?
%		\item $f_X(\hat{\omega}_i), \hat{\omega}_o))$: Materijal - za zadani ulazni i izlazni smjer, koji intenzitet svjetla ide u izlaznom smjeru?
%		\item $\left|\hat{\omega}_i\cdot \hat{n}\right|$: Lambert - geometrijski izraz, recimo, difuzni 
%	\end{itemize}
%\end{frame}
%
%\begin{frame}{Render jednadžba}
%	\begin{align*}
%	L_o(X, \hat{\omega}_o) = L_e(X, \hat{\omega}_e) +
%	\int_{S^2}  L_i(X, \hat{\omega}_i) f_X(\hat{\omega}_i), \hat{\omega}_o)) \left|\hat{\omega}_i\cdot \hat{n}\right| 
%	\mathrm{d} \hat{\omega}_i
%	\end{align*}
%	\begin{itemize}
%		\item $S^2$: svi dolazni, ulazni smjerovi(\textit{incoming directions})
%		\item $\mathrm{d} \hat{\omega}_i$
%	\end{itemize}
%Pure Path tracing: zbrojimo sva svjetla iz svih smjerova
%\end{frame}



\section{Sjene}

\begin{frame}{Sjene}
\begin{center}
	\includegraphics[width=8cm]{slike/sjene_01.png}
\end{center}

\end{frame}

\begin{frame}{Sjene, kostur algoritma}
\begin{algorithm*}[H]
%\KwResult{Write here the result }
color = ka*hit.material().kd()\;
\For{ za svaki izvor svjetla}
{
	Ray ray2(hitPoint, directionToLight)\;
	ambient = ka\;
	Hit hit2(distanceToLight)\;
	\For{ za svaki objekt}
	{
		object.intersect(ray2, hit2)\;
		%diffuseColor = object.intersect(ray2, hit2)\;
		\If{hit2->getT() == distanceToLight}
		{
			color += hit.getMaterial().shade(ray, hit, directionToLight, lightColor)\;
		}
	}
	
}
return color\;
%\caption{How to write algorithms}
\end{algorithm*}
\end{frame}

\begin{frame}{Sjene, contd.}
\begin{center}
\includegraphics[width=4cm]{slike/sjene_02.png}
\end{center}
U čemu se razlikuju \textit{shadow} zrake u odnosu na \textit{eye} zrake?\\
Nije potrebno naći najbliži objekt, dovoljno je da je samo jedan između zrake i izvora svjetla 
\end{frame}

\section{Refleksija}
\begin{frame}{Refleksija}

\begin{center}
\includegraphics[width=5cm]{slike/refleksija_01.png}
\end{center}
\begin{itemize}
\item Odaslati zraku simetrično na normalu
\item pomnožiti sa zrcalnom komponentom $k_s$, ili nešto slično tome
\end{itemize}
\end{frame}

\begin{frame}{Refleksija, kako izračunati zrcalnu zraku}

\begin{center}
	\includegraphics[width=3cm]{slike/refleksija.png}
\end{center}
\begin{align*}
	\theta= \theta_i = \theta_t
\end{align*}
\begin{align*}
\vec{\omega}_i + \vec{\omega}_o & = 2 \cos \theta \vec{n} = 2(\vec{\omega}_i \cdot \vec{n})\vec{n} \\
 \vec{\omega}_o & = -\vec{\omega}_i + 2(\vec{\omega}_i \cdot \vec{n})\vec{n}
\end{align*}
\end{frame}

\section{Difuzni i refleksivni materijali}
\begin{frame}{Difuzni materijal}
	\begin{center}
		\includegraphics[width=6cm]{slike/fig-1.08-light-bounce.jpg}
	\end{center}

\end{frame}

\begin{frame}{Difuzni materijal}
	\begin{columns}
		\begin{column}{0.3\textwidth}
			\begin{center}
				\includegraphics[width=4cm]{slike/fig-1.09-rand-vec.jpg}
			\end{center}
		\end{column}
	\begin{column}{0.7\textwidth}
		\begin{enumerate}
			\item Središta sfera: $\mathbf{P} + \mathbf{n}$ i $\mathbf{P} - \mathbf{n}$
			\item $\mathbf{P} - \mathbf{n}$ unutar, $\mathbf{P} + \mathbf{n}$ izvan
			\item Odabrati nasumičnu točku $\mathbf{S}$
			\item Definirati zraku koja prolazi kroz točke $\mathbf{P}$ i $\mathbf{S}$
			\item Odrediti koeficijent kojim se apsorbira svjetlost (intenzitet, nota bene)  :recimo $1/2$, $2/5$ $\ldots$
			\item Provjeriti siječe li se ta zraka s nekim objektom
			\item go to 3
			\item Funkcija je rekurzivna, obično se definira broj odbijanja (dubina): npr. $20, 30, 50, 100, \ldots$
		\end{enumerate}
	\end{column}
	\end{columns}
\end{frame}

\begin{frame}{Difuzni materijal}
	\begin{columns}
		\begin{column}{0.3\textwidth}
			\begin{center}
				\includegraphics[width=4cm]{slike/fig-1.10-rand-unitvec.png}
			\end{center}
		\end{column}
		\begin{column}{0.7\textwidth}
			\begin{enumerate}
				\item Središta sfera: $\mathbf{P} + \mathbf{n}$ i $\mathbf{P} - \mathbf{n}$
				\item $\mathbf{P} - \mathbf{n}$ unutar, $\mathbf{P} + \mathbf{n}$ izvan
				\item \alert{Bolje: Odabrati nasumičnu točku $\mathbf{S}$ \textbf{na površini kugle} }
				\item Definirati zraku koja prolazi kroz točke $\mathbf{P}$ i $\mathbf{S}$
				\item Odrediti koeficijent kojim se apsorbira svjetlost (intenzitet, nota bene)  :recimo $1/2$, $2/5$ $\ldots$
				\item Provjeriti siječe li se ta zraka s nekim objektom
				\item go to 3
				\item Funkcija je rekurzivna, obično se definira broj odbijanja (dubina): npr. $20, 30, 50, 100, \ldots$
			\end{enumerate}
		\end{column}
	\end{columns}
\end{frame}

\begin{frame}{Difuzni materijal}
	\begin{center}
		\includegraphics[width=4cm]{slike/img-1.07-first-diffuse.png}
	\end{center}
	\begin{itemize}
		\item Slike je previše tamna
	\end{itemize}
\end{frame}

\begin{frame}{Difuzni materijal, $\gamma$ korekcija}
	\begin{itemize}
		\item \textit{Dijelimo} intenzitet s nekim intenzitetom
		\item Potrebno je napraviti korekciju
		\item Boju \textit{staviti} na potenciju $1/\gamma$
	\end{itemize}
	\begin{center}
		\includegraphics[width=4cm]{slike/img-1.08-gamma-correct.png}
	\end{center}
\end{frame}


\begin{frame}{Refleksija, opet}
	\begin{columns}
		\begin{column}{0.3\textwidth}
			\begin{center}
				\includegraphics[width=3cm]{slike/refleksija_02.png}
			\end{center}
		\begin{align*}
		\theta= \theta_i = \theta_o
		\end{align*}
		\end{column}
		\begin{column}{0.7\textwidth}
		\begin{align*}
		-\mathbf{V} + \mathbf{R} & = 2 \cos \theta \mathbf{N} = 2(-\mathbf{V} \cdot \mathbf{N})\mathbf{N} \\
		\mathbf{R} & = \mathbf{V} - 2(\mathbf{V} \cdot \mathbf{N})\mathbf{N}
		\end{align*}
		\end{column}
	\end{columns}

Umjesto \textit{nasumične zrake}, odašiljemo samo jednu, u $\mathbf{R}$ smjeru.
\begin{center}
	\includegraphics[width=4cm]{slike/img-1.11-metal-shiny.png}
\end{center}
\end{frame}
\begin{frame}{Refleksija, opet}
	\begin{columns}
		\begin{column}{0.3\textwidth}
			\begin{center}
				\includegraphics[width=3cm]{slike/fig-1.12-reflect-fuzzy.jpg}
			\end{center}
		\end{column}
		\begin{column}{0.7\textwidth}
			Možda je ipak bolje odašiljati nasumične reflektirane zrake pomoću male sfere. \\
			Što veća sfera, refleksija je mutnija.
		\end{column}
	\end{columns}
	
	\begin{center}
		\includegraphics[width=4cm]{slike/img-1.12-metal-fuzz.png}
	\end{center}
\end{frame}


\section{Prozirnost, refrakcija}
\begin{frame}{Prozirnost, refrakcija}

\begin{center}
\includegraphics[width=5cm]{slike/prozirnost_01.png}
\end{center}
\begin{itemize}
\item Odaslati zraku u \textit{refrakcijskom} smjeru
\item pomnožiti s koeficijentom refrakcije $k_t$
\end{itemize}

\end{frame}

\begin{frame}{Prozirnost, contd.}

\begin{center}
\includegraphics[width=3cm]{slike/prozirnost_02.png}
\end{center}
\begin{itemize}
\item dva materijala, dva indeksa refrakcije, $\eta_i$ i $\eta_t$
\end{itemize}
\begin{columns}
	\begin{column}{0.5\textwidth}
		Snell-Descartes -ov zakon zakon:
		\begin{align*}
		\sin \eta_i \theta_i = \eta_t \sin\theta_t%  \\
		% \frac{\sin\theta_t}{\sin\theta_i} = \frac{\eta_t}{\eta_i} = \eta_r
		\end{align*}
		% Relativni indeks refrakcije: $\eta_r$\\
		Cilj je odrediti smjer zrake $\mathbf{T}$
	\end{column}
	\begin{column}{0.5\textwidth}
		\begin{center}
			\begin{tabular}{ l r } 
				\textbf{Medij} & $\eta$ \\
				\hline
				Vakuum & $1.0$  \\ 
				Zrak ($0$ m n. m.) & $1.00029$  \\ 
				Voda ($20$ °C) & $1.33$  \\ 
				Staklo & $1.5$-$1.6$  \\ 
				Dijamant & $2.42$  \\ 
				\hline
			\end{tabular}
		\end{center}
	\end{column}
\end{columns}

\end{frame}

\begin{frame}{Prozirnost, kako odrediti $\mathbf{T}$}
\begin{center}
\includegraphics[width=2.5cm]{slike/prozirnost_02.png}
\end{center}
\begin{align*}
\mathbf{T} = \mathbf{T}_\parallel + \mathbf{T}_\perp
\end{align*}
\begin{align*}
\mathbf{T}_\parallel = \frac{\eta_i}{\eta_t}\mathbf{I}_\parallel = \frac{\eta_i}{\eta_t}(\mathbf{I} + \cos \theta_i \mathbf{N})
\end{align*}
Sitnica: $ \cos \theta_i = \mathbf{I} \cdot \mathbf{N}$
\begin{align*}
\mathbf{T}_\perp = -\sqrt{1- |\mathbf{T}_\parallel|^2}\mathbf{N}
\end{align*}
\begin{align*}
\mathbf{T} = \mathbf{T}_\parallel + \mathbf{T}_\perp = \frac{\eta_i}{\eta_t}\mathbf{I} + \left(\frac{\eta_i}{\eta_t} \cos \theta_i - \sqrt{1- |\mathbf{T}_\parallel|^2}\right)\mathbf{N}
\end{align*}
%koristiti samo skalarne produkte\ldots
\end{frame}

\begin{frame}{Prozirnost, kako odrediti $\mathbf{T}$, contd.}
	\begin{align*}
	\mathbf{T} & = \frac{\eta_i}{\eta_t}\mathbf{I} + \left(\frac{\eta_i}{\eta_t} \cos \theta_i - \sqrt{1- |\mathbf{T}_\parallel|^2}\right)\mathbf{N} \\
	  & = \frac{\eta_i}{\eta_t}\mathbf{I} + \left(\frac{\eta_i}{\eta_t} \cos \theta_i - \sqrt{1- \sin^2 \theta_t}\right)\mathbf{N}
	\end{align*}
	Par identiteta:
	\begin{itemize}
		\item $ \cos \theta_i = \mathbf{I} \cdot \mathbf{N}$
		\item $\sin^2 \theta_t = (\frac{\eta_i}{\eta_t})^2\sin^2 \theta_i = (\frac{\eta_i}{\eta_t})^2(1-\cos^2 \theta_i)$
	\end{itemize}
\end{frame}

\begin{frame}{Prozirnost, kako odrediti $\mathbf{T}$, contd.}
	Ovdje smo stali:
	\begin{align*}
	\mathbf{T} = \left(\eta_r\cos\theta_i - \sqrt{1-\eta_r^2\sin^2\theta_i}\right)\mathbf{N} - \eta_r\mathbf{I} 
	\end{align*}
	Opet trigonometrija: $\sin^2 \alpha + \cos^2 \alpha= 1$
	\begin{align*}
	\mathbf{T} = \left(\eta_r\cos\theta_i - \sqrt{1-\eta_r^2(1-\cos^2\theta_i)}\right)\mathbf{N} - \eta_r\mathbf{I}
	\end{align*}
	Konačno, $\mathbf{N}\cdot \mathbf{I}= \cos\theta_i$
	
	\begin{block}{Konačan izraz}
		\begin{align*}
		\mathbf{T} = \left(\eta_r(\mathbf{N}\cdot \mathbf{I}) - \sqrt{1-\eta_r^2(1-(\mathbf{N}\cdot \mathbf{I})^2)}\right)\mathbf{N} - \eta_r\mathbf{I}
		\end{align*}
		Sve što nam treba:
		\begin{itemize}
			\item normala
			\item smjer od kuda dolazi zraka
			\item koeficijent refrakcije
		\end{itemize}
	\end{block}
\end{frame}

\begin{frame}{Refrakcija i refleksija?}
	\begin{itemize}
		\item Što ako je zraka unutar materijala s većim indeksom refrakcije?
	\end{itemize}
	\begin{align*}
		\cos \theta_o = \frac{\eta_i}{\eta_o} \cos \theta_i
	\end{align*}
\end{frame}
%\begin{frame}{Prozirnost, kako odrediti $\mathbf{T}$, contd.}
%\begin{align}
%\mathbf{T} &= -\mathbf{N}\cos\theta_t + \mathbf{M}\sin\theta_t \\
%&= -\mathbf{N}\cos\theta_t + ((\mathbf{N}\cos\theta_i - \mathbf{I})/\sin\theta_i)\sin\theta_t \\
%&= -\mathbf{N}\cos\theta_t + (\mathbf{N}\cos\theta_i - \mathbf{I})\eta_r \\
%&= \left(\eta_r\cos\theta_i - \cos\theta_t\right)\mathbf{N} - \eta_r\mathbf{I} \\
%&= \left(\eta_r\cos\theta_i - \sqrt{1-\sin^2\theta_t}\right)\mathbf{N} - \eta_r\mathbf{I} \\
%&= \left(\eta_r\cos\theta_i - \sqrt{1-\eta_r^2\sin^2\theta_i}\right)\mathbf{N} - \eta_r\mathbf{I} \\
%&= \left(\eta_r\cos\theta_i - \sqrt{1-\eta_r^2(1-\cos^2\theta_i)}\right)\mathbf{N} - \eta_r\mathbf{I} \\
%\mathbf{T} &= \left(\eta_r(\mathbf{N}\cdot \mathbf{I}) - \sqrt{1-\eta_r^2(1-(\mathbf{N}\cdot \mathbf{I})^2)}\right)\mathbf{N} - \eta_r\mathbf{I}
%\end{align}
%\end{frame}
%
%\begin{frame}{Prozirnost, kako odrediti $\mathbf{T}$, contd.}
%\begin{center}
%\includegraphics[width=3cm]{slike/prozirnost_03.png}
%\end{center}
%\begin{itemize}
%\item  U izvodu smo prvo zamijenili $\mathbf{M}$ iz $\mathbf{M} = (\mathbf{N}\cos\theta_i - \mathbf{I})/\sin\theta_i$
%\item uveli koeficijent refrakcije $\eta_r$
%\item Iskoristili $\sin^2 \alpha + \cos^2 \alpha= 1$
%\item Izrazili $\sin \theta_t$ pomoću $\sin \theta_i$
%\item Na kraju iskoristili činjenicu da je $\mathbf{N}\cdot \mathbf{I}= \cos\theta_i$
%\end{itemize}
%
%\end{frame}
\plain{Pitanja?}
\end{document}